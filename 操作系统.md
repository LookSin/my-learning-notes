# 1.基本概念

## 操作系统的作用

1. 系统资源的管理者
2. 用户和计算机硬件之间的接口
3. 对硬件机器的拓展

## 操作系统的体系结构

### 内核

内核是计算机配置的底层**软件**，是操作系统最基本、最核心的部分。

### 体系结构

- 大内核：主要功能模块，运行在核心态
- 微内核：只把最基本的功能保留在内核

## 处理器状态

- 用户态：CPU只能执行非特权指令
- 核心态：CPU既可以执行非特权、也可以执行特权指令

## 中断和异常

**中断的本质**：发生中断就意味着需要操作系统介入，开展管理工作。

**中断**可以使CPU从**用户态转为核心态**，使操作系统获得计算机的控制权。**核心态到用户态**的切换是通过执行一个**特权指令**。

中断分为外中断和内中断，只需看信号的来源是**CPU外部还是内部**。

内中断又称**异常**。

## 系统调用

系统调用可以理解为一种可供应用程序调用的特殊函数。系统调用会使处理器从用户态进入核心态。凡是与资源有关的操作，会直接影响其他进程的操作，这时候需要系统调用的操作。

过程：

传递系统调用参数->执行陷入指令(**用户态**)->执行系统调用相应服务程序(**核心态**)->返回应用程序

# 2.进程管理

## 进程与线程

### **基本概念**

程序段、数据段、PCB(进程控制块)三部分组成了进程实体。进程是一个动态的过程。

**进程**是进程实体的**运行过程**，是系统进行**资源分配和调度**的一个独立单位。

**线程**是一个基本的CPU执行单元，也是程序执行流的最小单位。

### 进程状态及转换

三种基本状态：

- 运行态：占有CPU，并在CPU上运行
- 就绪态：已经具备运行条件，但是没有空闲CPU，暂时不能运行
- 阻塞态：因等待某一事件而暂时不能运行

另外两种状态：

- 创建态：进程正在被创建，操作系统为进程分配资源、初始化PCB
- 终止态：进程正在从系统中撤销，操作系统会回收进程拥有的资源、撤销PCB

![image-20221118210747522](C:\Users\52908\AppData\Roaming\Typora\typora-user-images\image-20221118210747522.png)

### 线程状态及转换

线程也有就绪、阻塞、运行三种基本状态

**切换：**

- 同一进程中的线程切换，不会引起进程切换
- 不同进程中的线程切换，会引起进程切换
- 切换同进程内的线程，系统开销很小
- 切换进程，系统开销较大

## CPU进程调度算法

### 先来先服务(FCFS)

**非抢占式**。等待越久的越优先得到服务。不会导致饥饿。对长作业有利，对短作业不利。

周转时间 = 完成时间 - 到达时间

带权周转时间 = 周转时间/运行时间

等待时间 = 周转时间 - 运行时间

### 短作业优先(SJF)

**非抢占式。**

每次调度时选择当前已到达且运行时间最短的作业/进程。

若不强调非抢占式，默认非抢占。

"最短的"平均等待时间、平均周转时间。会产生饥饿。

### 最短剩余时间(SRTN)

**抢占式的短作业优先。**

- **每当有进程加入**、就绪队列改变时就需要调度，如果新到达的进程剩余时间更短，则由新进程抢占处理机
- **进程完成时**也需要调度

### 高响应比优先(HRRN)

**非抢占式。**避免长作业饥饿。

响应比 = (等待时间 + 要求服务时间)/要求服务时间

- 等待时间相同，服务时间短的优先
- 服务时间相同，等待时间长的优先

### 时间片轮转(RR)

**抢占式。**用于进程调度。

**优点：**公平；响应快，常用于分时操作系统，更注重"响应时间"。

不会导致饥饿。

时间片不能太大，会增大进程响应时间；也不能太小，会花大量的时间来处理进程切换。

### **优先级调度**

**抢占式、非抢占式。**

优先数越大，优先级越高。适合实时操作系统。可能导致饥饿。

### 多级反馈队列

**抢占式。**

设置多级就绪队列，各级优先级从高到低，时间片从小到大。

会导致饥饿。

## 进程同步与互斥

### 信号量机制

信号量表示系统中某种资源的数量。

原语是一种特殊的程序段，执行只能**一气呵成，不可被中断**。

**整型信号量(重要)：**整数型的变量，表示系统中某种资源的数量。不满足"让权等待"，会发生"忙等"。

**记录型信号量：**P、V操作；block、wakeup原语
